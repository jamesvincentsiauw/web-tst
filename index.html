<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fashion E-Commerce</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet">
    <link href="stylesheet.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" id="bootstrap-css" rel="stylesheet">
    <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="index.html">Fashion E-Commerce</a>
        <button aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation"
                class="navbar-toggler" data-target="#navbarsExampleDefault" data-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</nav>

<section class="jumbotron text-center">
    <div class="container">
        <h1 class="jumbotron-heading">Fashion E-Commerce</h1>
    </div>
</section>

<section class="pb-5" id="form">
    <div class="container py-3">
        <div class="row">
            <div class="mx-auto col-sm-7">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Please input your order and choose delivery provider</h5>
                    </div>
                    <div class="card-body">
                        <form autocomplete="off" class="form" id="formOrder" role="form">
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Name</label>
                                <div class="col-lg-9">
                                    <input class="form-control" id="name" placeholder="example: Petra" type="text">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Telephone Number</label>
                                <div class="col-lg-9">
                                    <input class="form-control" id="telp" placeholder="example: 085797498412"
                                           type="text">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Address</label>
                                <div class="col-lg-9">
                                    <input class="form-control" id="address" placeholder="example: Jl. Ganesha No. 10"
                                           type="text">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Category</label>
                                <div class="col-lg-9">
                                    <select class="browser-default custom-select" id="cat" name="cat"
                                            onchange="getBarang()">
                                        <option selected>Please choose product category</option>
                                        <option value="Tas">Tas</option>
                                        <option value="Kaos">Kaos</option>
                                        <option value="Sandal">Sandal</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Product</label>
                                <div class="col-lg-9">
                                    <select class="browser-default custom-select" id="product" onchange="showWeight()">
                                        <option selected>--</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Weight</label>
                                <div class="col-lg-9">
                                    <a id="weight">0</a> Gram
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Origin City</label>
                                <div class="col-lg-9">
                                    <select class="browser-default custom-select" id="origin" name="origin">
                                        <option selected>--</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Destination City</label>
                                <div class="col-lg-9">
                                    <select class="browser-default custom-select" id="destination" name="destination">
                                        <option selected>--</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Delivery Provider</label>
                                <div class="col-lg-9">
                                    <select class="browser-default custom-select" id="provider" name="courier">
                                        <option selected>Please choose delivery provider</option>
                                        <option value="JNE">JNE</option>
                                        <option value="Tiki">Tiki</option>
                                        <option value="Pos">Pos Indonesia</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label">Shipping Price</label>
                                <div class="col-md-4">
                                    Rp <a id="price">0</a>,-
                                </div>
                                <div class="col-md-4">
                                    <input onclick="calculatePrice()" type="button" value="Calculate">
                                </div>
                            </div>
                            <div class="form-group row total">
                                <label class="col-lg-3 col-form-label form-control-label">Total Price</label>
                                <div class="col-md-4">
                                    <strong>Rp <a id="totalPrice">0</a>,-</strong>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-lg-3 col-form-label form-control-label"></label>
                                <div class="col-lg-9">
                                    <input class="btn btn-success" data-target="#order" data-toggle="modal"
                                           id="orderButton" onclick="cetakModal()" type="button" value="Order!">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<article class="bg-secondary mb-3">
    <div class="card-body text-center">
        <h4 class="text-white">TUGAS BESAR TST <br> <br> Fashion E-Commerce </h4>
        <p class="h5 text-white"> with BukaLapak API & Pengiriman Logistik API</p>
        <p class="h5 text-white"> David Petra Natanael - 18217011 </p>
        <p class="h5 text-white"> Vincent - 18217042 </p>
    </div>
    <br>
</article>

<div id="overlay" style="display:none;">
    <div class="spinner"></div>
    <br/>
    Loading...
</div>

<!-- Modal -->
<div aria-hidden="true" aria-labelledby="orderLabel" class="modal fade" id="order" role="dialog"
     tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Please Confirm Your Order!</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <a id="modalName"><strong>Name: </strong></a><br>
                <a id="modalTelp"><strong>Telephone Number: </strong></a><br>
                <a id="modalAddress"><strong>Address: </strong></a><br>
                <a id="modalCategory"><strong>Category: </strong></a><br>
                <a id="modalProduct"><strong>Product: </strong></a><br>
                <a id="modalWeight"><strong>Weight: </strong></a><br>
                <a id="modalOrigin"><strong>Origin City: </strong></a><br>
                <a id="modalDest"><strong>Destination City: </strong></a><br>
                <a id="modalProvider"><strong>Delivery Provider: </strong></a><br>
                <a id="modalPrice"><strong>Shipping Price: </strong>Rp </a>,- <br>
                <strong><a class="total" id="modalTotalPrice">Total Price: Rp </a>,-</strong><br>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-success" type="submit">Order!</button>
            </div>
        </div>
    </div>
</div>

<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script crossorigin="anonymous" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
    function getCity() {
        $('#overlay').fadeIn().delay(3500).fadeOut();

        content = "<option>--</option>";
        $.ajax({
            url: 'http://52.23.248.58:8000/getcity',
            type: 'get',
            crossDomain: true,
            dataType: 'json',
            success: function (response) {
                console.log(response);
                $.each(response.slice(0, 501), function (key, value) {
                    content += "<option value=" + value.city_id + ">" + value.city_name + "</option>";
                });
                $('#origin').html(content);
                $('#destination').html(content);
            },
            error: function (response) {
                console.log(response);
            }
        })
    }

    function getBarang() {
        $('#overlay').fadeIn().delay(3500).fadeOut();

        content = "<option>--</option>";
        $.ajax({
            url: 'http://52.23.248.58:8080/' + $('#cat').val().toLowerCase(),
            type: 'get',
            crossDomain: true,
            dataType: 'json',
            success: function (response) {
                console.log(response);
                $.each(response.slice(0, 20), function (key, value) {
                    content += "<option value=" + value.nama + ">" + value.nama + "|<strong>Harga: Rp " + value.harga + "</strong></option>";
                });
                $('#product').html(content);
            },
            error: function (response) {
                console.log(response);
            }
        })
    }

    $(document).ready(
        function () {
            getCity();
        }
    );

    var i = 0;

    function cetakModal() {
        if (i === 0) {
            $('#modalName').append($('#name').val());
            $('#modalTelp').append($('#telp').val());
            $('#modalAddress').append($('#address').val());
            $('#modalCategory').append($('#cat').val());
            $('#modalProduct').append($('#product :selected').html().split('|')[0]);
            $('#modalWeight').append($('#weight').html());
            $('#modalOrigin').append($('#origin :selected').html());
            $('#modalDest').append($('#destination :selected').html());
            $('#modalProvider').append($('#provider').val());
            $('#modalPrice').append($('#price').html());
            $('#modalTotalPrice').append($('#totalPrice').html());
            i++;
        }
    }

    function showWeight() {
        $('#weight').html(Math.floor(Math.random() * 10000));
    }

    function calculatePrice() {
        var weight = Number($('#weight').html());
        var origin = Number($('#origin').val());
        var destination = Number($('#destination').val());
        var courier = $('#provider').val().toLowerCase();
        console.log("weight: " + weight);
        console.log("origin: " + origin);
        console.log("destination: " + destination);
        console.log("courier: " + courier);
        $.ajax({
            url: 'http://3.92.50.97:4040/api/cost',
            type: 'post',
            data: {
                'origin': origin,
                'destination': destination,
                'weight': weight,
                'courier': courier
            },
            success: function (response) {
                $('#price').html(response);
                var total = Number(response) + Number($('#product :selected').html().split('Rp ')[1]);
                console.log("tes: " + Number($('#product :selected').html().split('Rp ')[1]));
                console.log("total: " + total);
                $('#totalPrice').html(total);
                if (response !== 999 || response !== "999") {
                    $('#orderButton').disabled = false
                } else {
                    $('#orderButton').disabled = true
                }
                console.log(response)
            },
            error: function (response) {
                console.log(response)
            }
        })
    }

    function createOrder() {
        var name = $('#name').val();
        var origin = $('#origin :selected').html();
        var destination = $('#destination :selected').html();
        var goods = $('#product :selected').html();
        var weight = $('#weight').html();
        var cost = $('#totalPrice').html();
        var courier = $('#provider').val().toLowerCase();
        console.log("name: " + name);
        console.log("origin: " + origin);
        console.log("destination: " + destination);
        console.log("goods: " + goods);
        console.log("weight: " + weight);
        console.log("cost: " + cost);
        console.log("courier: " + courier);
        $.ajax({
            url: 'http://3.92.50.97:4040/api/order',
            type: 'post',
            data: {
                'data': {
                    'name': name,
                    'origin': origin,
                    'destination': destination,
                    'goods': goods,
                    'weight': weight,
                    'cost': cost,
                    'courier': courier,
                }
            },
            success: function (response) {
                console.log(response)
            },
            error: function (response) {
                console.log(response)
            }
        })
    }

</script>
</body>
</html>